<h1>Оглавление<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Описание-этапа-обработки" data-toc-modified-id="Описание-этапа-обработки-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Описание этапа обработки</a></span></li><li><span><a href="#Описание-данных" data-toc-modified-id="Описание-данных-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Описание данных</a></span></li><li><span><a href="#Описание-задачи" data-toc-modified-id="Описание-задачи-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Описание задачи</a></span><ul class="toc-item"><li><span><a href="#Используемые-термины" data-toc-modified-id="Используемые-термины-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>Используемые термины</a></span></li></ul></li><li><span><a href="#План-работ" data-toc-modified-id="План-работ-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>План работ</a></span></li><li><span><a href="#Проведем-изучение-данных" data-toc-modified-id="Проведем-изучение-данных-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Проведем изучение данных</a></span><ul class="toc-item"><li><span><a href="#Графические-данные-об-электродах" data-toc-modified-id="Графические-данные-об-электродах-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Графические данные об электродах</a></span></li><li><span><a href="#Графические-данные-о-продувке-сплава-газом" data-toc-modified-id="Графические-данные-о-продувке-сплава-газом-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>Графические данные о продувке сплава газом</a></span></li><li><span><a href="#Результаты-измерения-температуры" data-toc-modified-id="Результаты-измерения-температуры-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>Результаты измерения температуры</a></span></li></ul></li><li><span><a href="#Выводы-по-результатам-изучения-данных" data-toc-modified-id="Выводы-по-результатам-изучения-данных-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Выводы по результатам изучения данных</a></span></li><li><span><a href="#Предобработка-данных" data-toc-modified-id="Предобработка-данных-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Предобработка данных</a></span></li><li><span><a href="#Подготовка-данных" data-toc-modified-id="Подготовка-данных-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>Подготовка данных</a></span></li><li><span><a href="#Разобьем-данные" data-toc-modified-id="Разобьем-данные-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Разобьем данные</a></span></li><li><span><a href="#Обучение-моделей" data-toc-modified-id="Обучение-моделей-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Обучение моделей</a></span><ul class="toc-item"><li><span><a href="#LinearRegression-через-кросс-валидацию" data-toc-modified-id="LinearRegression-через-кросс-валидацию-10.1"><span class="toc-item-num">10.1&nbsp;&nbsp;</span>LinearRegression через кросс валидацию</a></span></li><li><span><a href="#RandomForestRegressor-через-GridSearchCV" data-toc-modified-id="RandomForestRegressor-через-GridSearchCV-10.2"><span class="toc-item-num">10.2&nbsp;&nbsp;</span>RandomForestRegressor через GridSearchCV</a></span></li><li><span><a href="#CatBoostRegressor-через-GridSearchCV" data-toc-modified-id="CatBoostRegressor-через-GridSearchCV-10.3"><span class="toc-item-num">10.3&nbsp;&nbsp;</span>CatBoostRegressor через GridSearchCV</a></span></li><li><span><a href="#Создадим-сводную-табличку-моделей-по-метрике-MAE" data-toc-modified-id="Создадим-сводную-табличку-моделей-по-метрике-MAE-10.4"><span class="toc-item-num">10.4&nbsp;&nbsp;</span>Создадим сводную табличку моделей по метрике MAE</a></span></li></ul></li><li><span><a href="#Тестирование-модели-CatBoostRegressor" data-toc-modified-id="Тестирование-модели-CatBoostRegressor-11"><span class="toc-item-num">11&nbsp;&nbsp;</span>Тестирование модели CatBoostRegressor</a></span></li><li><span><a href="#Анализ-важности-факторов" data-toc-modified-id="Анализ-важности-факторов-12"><span class="toc-item-num">12&nbsp;&nbsp;</span>Анализ важности факторов</a></span></li><li><span><a href="#Итоговый-вывод-и-отчет" data-toc-modified-id="Итоговый-вывод-и-отчет-13"><span class="toc-item-num">13&nbsp;&nbsp;</span>Итоговый вывод и отчет</a></span></li></ul></div>

# Экономим энергию для ООО «Так закаляем сталь»

## Описание этапа обработки

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша. 

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. *slab*, «плита»).

## Описание данных

Данные состоят из файлов, полученных из разных источников:

- `data_arc.csv` — данные об электродах;
- `data_bulk.csv` — данные о подаче сыпучих материалов (объём);
- `data_bulk_time.csv` *—* данные о подаче сыпучих материалов (время);
- `data_gas.csv` — данные о продувке сплава газом;
- `data_temp.csv` — результаты измерения температуры;
- `data_wire.csv` — данные о проволочных материалах (объём);
- `data_wire_time.csv` — данные о проволочных материалах (время).

Во всех файлах столбец `key` содержит номер партии. В файлах может быть несколько строк с одинаковым значением `key`: они соответствуют разным итерациям обработки.

## Описание задачи

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Нам предстоит построить модель, которая предскажет температуру стали.

### Используемые термины

* **Активная мощность** - Активная мощность характеризует скорость необратимого превращения электрической энергии в другие виды энергии (тепловую и электромагнитную).
* **Реактивная мощность** — это энергия, перекачиваемая от источника на реактивные элементы приёмника (индуктивности, конденсаторы, обмотки двигателей), а затем возвращаемая этими элементами обратно в источник в течение одного периода колебаний, отнесённая к этому периоду. 
* **Полная мощность** - вся та мощность, которая потребляется электроприбором и включает в себя как активную составляющую, так и составляющую реактивную. Определяется по формуле:  $$S = \sqrt{P^2 + Q^2}$$ где  **Р**  — активная мощность, **Q** — реактивная мощность
* **bulk** - объем

## План работ

* Описание задачи
* Изучение и подготовка данных:
     * Выгрузка данных
     * Изучение данных
     * Выводы по данным

* Предобработка данных:
    * Проверка типов данных
    * Работа с пропусками
* Подготовка данных:
    * Проверка на мультиколлинеарность
    * Формирование итоговых датафреймов
    * Формирование целевого и остальных признаков
    * Формирование обучающих и тестовых выборок
* Обучение моделей:
    * 3 модели
* Тестирование моделей:
    * Анализ важности факторов
* Итоговый вывод

## Итоговый вывод и отчет

Нашей задачей было  построить модель, которая предскажет температуру стали и таким образом уменьшить потребления электроэнергии на этапе обработки стали.
* В рамках данной работы наиболее сложным было определить подходы для решения обозначенной проблемы и понять с чего начать. Однако, решая указанную задачу мы:
*  Составили план работ, изучили и подготовили данные, сделали по ним промежуточные выводы, определили, что это задача регрессии.
* Провели предобработку данных, удалили аномальные данные, обработали пропуски.
* Сформировали итоговый дата фрейм для обучения моделей, проверили данные в нем на мультиколлиниарность, избавились от высокоскореллированных признаков, сформировали целевые и обучающие признаки, создали обучающие и тестовые выборки.
* На подготовленных данных обучили 3 модели:
    *  LinearRegression через кросс валидацию -  MAE 6.15 
    *  RandomForestRegressor через GridSearchCV - MAE 6.16 
    *  CatBoostRegressor через GridSearchCV - MAE - 5.82
* Из которых  CatBoostRegressor показал наилучший результат со следующими параметрами: {'iterations': 400, 'learning_rate': 0.05, 'max_depth': 6}
* **Лучшую модель - CatBoostRegressor -** протестировали на тестовых данных: показатель средней абсолютной ошибки (MAE)  составил всего **6.06**. 
* Таким образом, по качеству предсказаний наша модель соответствует предъявленным требованиям: величина средней абсолютной ошибки (MAE)  должна была быть меньше 6.8 
* Также провели анализ важности факторов, в рамках которого определили, что наиболее значимыми факторами для качества предсказаний модели являются потреблённая на нагрев металла энергия и начальная температура металла. График ниже для наглядности:

![image.png](attachment:image.png)
